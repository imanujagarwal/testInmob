package com.inmobi.rendering.a;

import android.annotation.TargetApi;
import android.content.ContentValues;
import android.graphics.Bitmap;
import android.net.Uri;
import android.os.Build.VERSION;
import android.os.Handler;
import android.os.HandlerThread;
import android.os.Looper;
import android.os.Message;
import android.os.SystemClock;
import android.webkit.WebResourceError;
import android.webkit.WebResourceRequest;
import android.webkit.WebResourceResponse;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import com.inmobi.a.n;
import com.inmobi.ads.c.e;
import com.inmobi.commons.core.configs.b.c;
import com.inmobi.commons.core.configs.h;
import com.inmobi.commons.core.network.NetworkError;
import com.inmobi.commons.core.network.NetworkError.ErrorCode;
import com.inmobi.commons.core.network.WebViewNetworkTask;
import com.inmobi.commons.core.network.WebViewNetworkTask.NetworkTaskWebView;
import com.inmobi.commons.core.network.e;
import com.inmobi.commons.core.utilities.g;
import com.inmobi.commons.core.utilities.g.b;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.atomic.AtomicBoolean;








public class c
  implements b.c
{
  private static final String a = c.class.getSimpleName();
  


  private static c b;
  

  private static final Object c = new Object();
  
  private static ExecutorService d;
  private static a e;
  private static HandlerThread f;
  private static List<a> g = new ArrayList();
  
  private static b h;
  private static AtomicBoolean i = new AtomicBoolean(false);
  
  private static c.e j;
  
  private static final Object k = new Object();
  
  private long l = 0L;
  
  public static c a()
  {
    c localC1;
    if ((localC1 = b) == null) {
      synchronized (c)
      {
        if ((localC1 = b) == null)
        {
          b = localC1 = new c();
        }
      }
    }
    
    return localC2;
  }
  



  public final void b()
  {
    try
    {
      if (!com.inmobi.commons.core.utilities.d.a()) {
        return;
      }
      
      synchronized (k) {
        if (i.compareAndSet(false, true))
        {
          if (f == null)
          {
            (c.f = new HandlerThread("pingHandlerThread")).start();
          }
          
          if (e == null) {
            e = new a(f.getLooper());
          }
          
          if (b.a())
          {
            i.set(false);
            i();
          } else {
            Message localMessage;
            obtainwhat = 1;
            e.sendMessage(localMessage);
          }
        }
        return;
      }
      


      return;
    }
    catch (Exception localException)
    {
      new StringBuilder("SDK encountered unexpected error in starting the ping component; ").append(localException.getMessage());
    }
  }
  






































  public final void a(final String paramString, final Map<String, String> paramMap)
  {
    new Thread()
    {
      public final void run()
      {
        try
        {
          Object localObject = new h();
          com.inmobi.commons.core.configs.b.a().a((com.inmobi.commons.core.configs.a)localObject, null);
          if (!
          























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































            g)
          {
            localObject = new a(paramString, paramMap, c, 
            















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              ca + 1);c.d();new StringBuilder("Received click (").append(b).append(") for pinging over HTTP");c.a(c.this, (a)localObject);
          }
          return;
        } catch (Exception localException) { c.d();new StringBuilder("SDK encountered unexpected error in pinging click; ")
            .append(localException.getMessage());
          com.inmobi.commons.core.a.a.a().a(new com.inmobi.commons.core.e.a(localException));
        }
      }
    }.start();
  }
  


















  private static void i()
  {
    try
    {
      i.set(false);
      synchronized (k) {
        if (!i.get()) {
          if (f != null) {
            f.getLooper().quit();
            f
              .interrupt();
            f = null;
            e = null;
          }
          g.clear();
        }
        return;
      }
    } catch (Exception localException) {
      new StringBuilder("SDK encountered unexpected error in stopping the ping component; ").append(localException.getMessage());
    }
  }
  
























































































  private final d m = new d()
  {
    public final void a(a paramAnonymousA) {
      if (paramAnonymousA != null) {
        c.d();new StringBuilder("Processing click (").append(b).append(") completed");
        c.e();b.a(paramAnonymousA);
        try
        {
          HashMap localHashMap;
          (localHashMap = new HashMap()).put("url", b);
          localHashMap.put("latency", Long.valueOf(SystemClock.elapsedRealtime() - c.b(c.this)));
          com.inmobi.commons.core.e.b.a();com.inmobi.commons.core.e.b.a("ads", "PingLatency", localHashMap); return;
        } catch (Exception localException) {
          c.d();new StringBuilder("Error in submitting telemetry event : (").append(localException.getMessage()).append(")");
        }
      }
    }
    
    public final void b(a paramAnonymousA)
    {
      if (paramAnonymousA != null) {
        c.d();new StringBuilder("Pinging click (").append(b).append(") failed! Updating retry counts and timestamps ...");
        c.a(paramAnonymousA);
        b();
      } } };
  
  static abstract interface d { public abstract void a(a paramA);
    
    public abstract void b(a paramA); }
  
  static final class c { private c.d a;
    
    public c(c.d paramD) { a = paramD; }
    
    public final void a(a paramA)
    {
      try {
        com.inmobi.commons.core.network.c localC = new com.inmobi.commons.core.network.c("GET", b);
        


        if (!(localObject = c.b(paramA)).isEmpty()) {
          localC.a((Map)localObject);
        }
        

































































































































































































































































































































































































































































































































































































































































































































































































        u = false;localC.b(c);
        













































































































        t = i;
        



















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































        r = (cc * 1000);
        










































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































        s = (cc * 1000);long l = SystemClock.elapsedRealtime();Object localObject = new e(localC).a();
        try
        {
          n.a().a(localC.g());
          n.a().b(((com.inmobi.commons.core.network.d)localObject).c());
          n.a().c(SystemClock.elapsedRealtime() - l);
        } catch (Exception localException1) {
          c.d();new StringBuilder("Error in setting request-response data size. ").append(localException1.getMessage());
        }
        

        if (((com.inmobi.commons.core.network.d)localObject).a()) {
          NetworkError.ErrorCode localErrorCode = 
          






















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































            b.a;
          if ((!i) && ((NetworkError.ErrorCode.HTTP_SEE_OTHER == localErrorCode) || (NetworkError.ErrorCode.HTTP_MOVED_TEMP == localErrorCode)))
          {

            a.a(paramA);return;
          }
          a.b(paramA);
          
          return; }
        a.a(paramA); return;
      }
      catch (Exception localException2) {
        c.d();new StringBuilder("SDK encountered unexpected error in executing ping over HTTP; ")
          .append(localException2.getMessage());
        new NetworkError(NetworkError.ErrorCode.UNKNOWN_ERROR, "Unknown error");a.b(paramA);
      }
    }
  }
  
  private static HashMap<String, String> c(a paramA)
  {
    HashMap localHashMap = new HashMap();
    
    try
    {
      if ((paramA = 
      
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































        ja - f + 1) > 0)
      {
        localHashMap.put("X-im-retry-count", String.valueOf(paramA));
      }
    }
    catch (Exception localException) {}
    

    return localHashMap;
  }
  
  static final class b {
    c.d a;
    
    public b(c.d paramD) {
      a = paramD;
    }
    
    public final void a(final a paramA) {
      g.set(false);
      final Handler localHandler;
      (localHandler = new Handler(Looper.getMainLooper())).post(new Runnable()
      {
        public final void run() {
          Object localObject1 = new com.inmobi.commons.core.network.c("GET", paramAb);
          
          Object localObject2;
          
          if (!(localObject2 = c.b(paramA)).isEmpty()) {
            ((com.inmobi.commons.core.network.c)localObject1).a((Map)localObject2);
          }
          


































































































          localObject1 = new WebViewNetworkTask((com.inmobi.commons.core.network.c)localObject1, new WebViewClient()
          {
            AtomicBoolean a;
            boolean b;
            
            public final void onPageStarted(final WebView paramAnonymous2WebView, String paramAnonymous2String, Bitmap paramAnonymous2Bitmap)
            {
              a = new AtomicBoolean(false);
              b = false;
              new Thread(new Runnable()
              {
                public final void run() {
                  try {
                    Thread.sleep(
                    




































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                      cc * 1000);
                  }
                  catch (InterruptedException localInterruptedException) {}
                  

                  if (!a.get()) {
                    c.d();new StringBuilder("Pinging click (").append(a.b).append(") via WebView timed out!");
                    a.g.set(true);
                    
                    b.post(new Runnable()
                    {
                      public final void run()
                      {
                        try {
                          WebViewNetworkTask.NetworkTaskWebView localNetworkTaskWebView;
                          if (((localNetworkTaskWebView = (WebViewNetworkTask.NetworkTaskWebView)a) != null) && (!a))
                            a.stopLoading();
                          return;
                        } catch (Throwable localThrowable) {
                          com.inmobi.commons.core.a.a.a().a(new com.inmobi.commons.core.e.a(localThrowable));
                        }
                        
                      }
                    });
                    






















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                    a.b(a);
                  }
                }
              })
              





























                .start();
            }
            











            @TargetApi(22)
            public final void onReceivedError(WebView paramAnonymous2WebView, int paramAnonymous2Int, String paramAnonymous2String1, String paramAnonymous2String2)
            {
              b = true;
              

































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              a.b(a);
            }
            
            @TargetApi(23)
            public final void onReceivedError(WebView paramAnonymous2WebView, WebResourceRequest paramAnonymous2WebResourceRequest, WebResourceError paramAnonymous2WebResourceError)
            {
              b = true;
              


































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              a.b(a);
            }
            
            @TargetApi(23)
            public final void onReceivedHttpError(WebView paramAnonymous2WebView, WebResourceRequest paramAnonymous2WebResourceRequest, WebResourceResponse paramAnonymous2WebResourceResponse)
            {
              b = true;
              



































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              a.b(a);
            }
            
            public final boolean shouldOverrideUrlLoading(WebView paramAnonymous2WebView, WebResourceRequest paramAnonymous2WebResourceRequest)
            {
              if (Build.VERSION.SDK_INT >= 21) {
                if ((!a.i) && 
                  (!paramAnonymous2WebResourceRequest.getUrl().toString().equals(a.b))) {
                  return true;
                }
                
                return false;
              }
              return false;
            }
            


            public final boolean shouldOverrideUrlLoading(WebView paramAnonymous2WebView, String paramAnonymous2String)
            {
              if ((!a.i) && 
                (!paramAnonymous2String.equals(a.b))) {
                return true;
              }
              
              return false;
            }
            
            public final void onPageFinished(WebView paramAnonymous2WebView, String paramAnonymous2String)
            {
              a.set(true);
              if ((!b) && 
                (!a.g.get())) {
                
                


































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                  a.a(a);
              }
            }
          });
          try
          {
            c = new WebViewNetworkTask.NetworkTaskWebView((WebViewNetworkTask)localObject2, com.inmobi.commons.a.a.b());
            c.setWebViewClient(b);
            c.getSettings().setJavaScriptEnabled(true);
            c.getSettings().setCacheMode(2);c.loadUrl(a.e(), a.d()); return;
          }
          catch (Exception localException)
          {
            new StringBuilder("SDK encountered unexpected error in WebViewNetworkTask.execute() method; ").append(localException.getMessage());
          }
        }
      });
    }
  }
  
  final class a
    extends Handler
  {
    public a(Looper paramLooper) { super(); }
    
    public final void handleMessage(Message paramMessage) {
      try { Object localObject1;
        int k;
        Object localObject3;
        switch (what)
        {
        case 1: 
          h localH = new h();
          com.inmobi.commons.core.configs.b.a().a(localH, null);
          if (!
          













































































































































































































































































































































































































































































































































































































































































            g)
          {
            c.e();int j = 
            
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              cb;int i = ce;
            
















































































































































            paramMessage = new ArrayList();
            com.inmobi.commons.core.d.b localB;
            if ((localB = com.inmobi.commons.core.d.b.a()).a("click") != 0)
            {


              localObject1 = -1 == i ? null : Integer.toString(i);
              localObject1 = localB.a("click", b.a, null, null, "ts", "ts < " + (System.currentTimeMillis() - j), "ts ASC ", (String)localObject1);
              localB.b();
              for (localObject1 = ((List)localObject1).iterator(); ((Iterator)localObject1).hasNext();) { localObject2 = (ContentValues)((Iterator)localObject1).next();
                paramMessage.add(b.a((ContentValues)localObject2));
              }
            }
            c.a(
            















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              paramMessage);
            if (c.f().isEmpty()) {
              c.e(); if (b.a()) {
                c.g().set(false);return;
              }
              
              obtainwhat = 1;
              sendMessageDelayed((Message)localObject2, 
              
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                cb * 1000);return;
            }
            Object localObject2 = (a)c.f().get(0);
            
            obtainwhat = (h ? 3 : 2);
            obj = localObject2;
            long l;
            if ((l = System.currentTimeMillis() - d) < 
            
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































              cb * 1000) {
              sendMessageDelayed((Message)localObject1, 
              























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                cb * 1000 - l);return;
            }
            sendMessage((Message)localObject1); return;
          }
          

          break;
        case 2: 
          if (!com.inmobi.commons.core.utilities.d.a()) {
            c.g().set(false);
            c.h();
            return;
          }
          

          if (obj).f == 0) {
            a((a)localObject1, 1);
            return; }
          if (((a)localObject1).a(
          





















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































            cf))
          {
            a((a)localObject1, 2);
            return;
          }
          

          if ((k = 
          



































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































            ca - f + 1) == 0)
          {


            c.d();new StringBuilder("Pinging click (").append(b).append(") over HTTP");
          } else {
            c.d();new StringBuilder("Retry attempt #").append(k).append(" for click (").append(b).append(") over HTTP");
          }
          











          new c.c(new c.d()
          {
            public final void a(a paramAnonymousA)
            {
              c.a.a(c.a.this, paramAnonymousA);
            }
            
            public final void b(a paramAnonymousA)
            {
              c.d();new StringBuilder("Pinging click (").append(b).append(") via HTTP failed ...");
              c.a(paramAnonymousA);
              c.a.b(c.a.this, paramAnonymousA); } })
          
            .a((a)localObject1);
          
          return;
        
        case 3: 
          if (!com.inmobi.commons.core.utilities.d.a()) {
            c.g().set(false);
            c.h();
            return;
          }
          


          if (obj).f == 0) {
            a((a)localObject1, 1);
            return; }
          if (((a)localObject1).a(
          



















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































            cf))
          {
            a((a)localObject1, 2);
            return;
          }
          

          if ((k = 
          

































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































            ca - f + 1) == 0)
          {


            c.d();new StringBuilder("Pinging click (").append(b).append(") in WebView");
          } else {
            c.d();new StringBuilder("Retry attempt #").append(k).append(" for click (").append(b).append(") using WebView");
          }
          











          new c.b(new c.d()
          {
            public final void a(a paramAnonymousA)
            {
              c.a.a(c.a.this, paramAnonymousA);
            }
            
            public final void b(a paramAnonymousA)
            {
              c.d();new StringBuilder("Pinging click (").append(b).append(") via WebView failed ...");
              c.a(paramAnonymousA);
              c.a.b(c.a.this, paramAnonymousA); } })
          
            .a((a)localObject1);
          
          return;
        
        case 5: 
          localObject1 = (a)obj;
          (
            localObject3 = new HashMap()).put("pingUrl", b);
          
          switch (arg1) {
          case 1: 
            ((Map)localObject3).put("errorCode", "MaxRetryCountReached");
            break;
          case 2: 
            ((Map)localObject3).put("errorCode", "ExpiredClick");
          }
          
          

          try
          {
            com.inmobi.commons.core.e.b.a();com.inmobi.commons.core.e.b.a("ads", "PingDiscarded", (Map)localObject3);
          } catch (Exception localException1) {
            c.d();new StringBuilder("Error in submitting telemetry event : (")
              .append(localException1.getMessage()).append(")");
          }
        
        case 4: 
          a localA = (a)obj;
          c.d();new StringBuilder("Processing click (").append(b).append(") completed");
          c.e();b.a(localA);
          c.f().remove(localA);
          
          if (c.f().isEmpty()) {
            c.e(); if (b.a()) {
              c.d();
              c.g().set(false);return;
            }
            
            obtainwhat = 1;
            sendMessage((Message)localObject3);
            return;
          }
          localA = (a)c.f().get(0);paramMessage = this;
          











































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































          obtainwhat = (h ? 3 : 2);
          obj = localA;
          paramMessage.sendMessage((Message)localObject3);
        }
        return;
      }
      catch (Exception localException2)
      {
        c.d();new StringBuilder("SDK encountered unexpected error in processing ping; ")
          .append(localException2.getMessage());
      }
    }
    



    private void a(a paramA, int paramInt)
    {
      Message localMessage;
      


      obtainwhat = 5;
      obj = paramA;
      arg1 = paramInt;
      
      sendMessage(localMessage);
    }
  }
  
  public final void a(com.inmobi.commons.core.configs.a paramA)
  {
    j = 
    
































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































      h;
  }
  
  public c()
  {
    c localC = this;
    

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    try
    {
      d = Executors.newFixedThreadPool(5);
      (
        c.f = new HandlerThread("pingHandlerThread")).start();
      e = new a(localC, f.getLooper());
      
      com.inmobi.ads.c localC1 = new com.inmobi.ads.c();
      com.inmobi.commons.core.configs.b.a().a(localC1, localC);
      j = 
      














































































































































































































































































































































































































































































































        h;h = new b();
      


































































































































































































































































































































































































































































































































      g.a().a(new g.b()
      {
        public final void a(boolean paramAnonymousBoolean)
        {
          if (paramAnonymousBoolean) {
            b();
          }
        }
      });
      























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































      if (Build.VERSION.SDK_INT >= 23) {
        g.a().a("android.os.action.DEVICE_IDLE_MODE_CHANGED", new g.b()
        {
          public final void a(boolean paramAnonymousBoolean)
          {
            if (!paramAnonymousBoolean) {
              b();








































































































































































































































































































































            }
            








































































































































































































































































































































          }
          









































































































































































































































































































































        });








































































































































































































































































































































      }
      








































































































































































































































































































































    }
    catch (Exception localException)
    {








































































































































































































































































































































      new StringBuilder("SDK encountered unexpected error in initializing the ping component; ").append(localException.getMessage());
    }
  }
}
